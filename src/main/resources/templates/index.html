<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>강의평가 웹 사이트</title>
    <th:block th:replace="~{fragments/config :: configFragment}"></th:block>
</head>
<body class="d-flex flex-column min-vh-100">
<th:block th:utext="${alertScript}"></th:block>
<th:block th:object="${loginUser}">
<div th:replace="~{fragments/header :: headerFragment}"></div>
    <section class="container mt-3 mb-3" style="max-width: 1200px;">
        <h2 class="mb-3 mt-3" style="text-align: center;">강의평가 목록</h2>
        <form method="get" th:action="@{/searchByType}" class="form-inline mt-3">
            <div style="display: flex;">
                <select name="searchType" class="form-select mx-1 mt-2" style="width: 100px;">
                    <option value="최신순" name="searchType">최신순</option>
                    <option value="추천순" name="searchType" th:seleted="${searchType == '추천순'}">추천순</option>
                </select>
                <input type="text" name="searchText" class="form-control mx-1 mt-2" placeholder="검색어를 입력하세요.">
                <button type="submit" class="btn btn-primary mx-1 mt-2" style="width: 90px;">검색</button>
                <a class="btn btn-danger mx-1 mt-2" data-bs-toggle="modal" data-bs-target="#reportModal" style="width: 90px;">신고</a>
            </div>
        </form>
        <div class="mt-3"><b th:text="${'총 강의평가 수 ' + evaluationListSize + '개'}"></b></div>
        <div>
            <div class="row">
            <th:block th:each="list : ${evaluationList}">
                <div class="col-sm-6 mb-3 mb-sm-0">
                    <div class="card bg-light mt-3 mb-3">
                        <div class="card-header bg-light">
                            <div class="row">
                                <b><div class="col-8 text-left w-100" id="my-col-8" th:text="${list.lectureName + ' (' + list.lectureProfessor + ')'}"></div></b>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="cart-title" th:text="${list.evaluationTitle}"></h5>
                            <p class="cart-text" th:text="${list.evaluationContent}"></p>
                            <div class="row" style="justify-content: flex-end;">
                                <div class="col-3 text-right" style="display: flex; justify-content: flex-end; width: 100%; align-items: center;">
                                    <span style="margin-right: auto; color: darkseagreen;" th:text="${'추천 : ' + list.likeCount}"></span>
<!--                                    <img width="50px" th:src="@{img/like-icon.png}">--><!-- 추천 아이콘 -->
                                    <th:block th:if="${loginUser != null}">
                                        <form th:action="@{/likeyAction/__${evaluationID}__}" method="POST" onsubmit="return likeyCheck()">
                                            <input type="hidden" th:name="evaluationID" th:value="${list.id}">
                                            <input type="submit" class="btn btn-outline-success" value="추천" />
                                        </form>
                                        <th:block th:if="${userNumber == list.userNumber}">
                                            <input type="button" class="btn btn-outline-success"
                                                   data-bs-toggle="modal" data-bs-target="#registerModal"
                                                   th:attr="data-target=${'#registerModal'+ list.id},
                                                    data-id=${list.id},
                                                    data-subject=${list.lectureName},
                                                    data-professor=${list.lectureProfessor},
                                                    data-title=${list.evaluationTitle},
                                                    data-content=${list.evaluationContent}"
                                                   value="수정" style="margin-left:5px;">
                                            <form th:action="@{/deleteAction/__${id}__}" method="POST" onsubmit="return deleteCheck()">
                                                <input type="hidden" th:name="id" th:value="${list.id}">
                                                <input type="submit" class="btn btn-outline-secondary" value="삭제" style="margin-left:5px;"/>
                                            </form>
                                        </th:block>
                                    </th:block>
                                    <div style="width: 130px;">
                                        <button class="btn btn-success" th:attr="onclick=|window.open('${list.lectureURL}', '_blank')|" style="margin-left:5px;">강의보러가기</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </th:block>
            </div>
        </div>
    </section>
    <!-- 페이지네이션 -->
    <nav aria-label="Page navigation" class="mt-3 mb-3 m-auto">
        <ul class="pagination">
            <li class="page-item" th:classappend="${1 == evaluationList.pageable.pageNumber + 1} ? 'disabled'">
                <a class="page-link" th:href="@{/(page=${evaluationList.pageable.pageNumber - 1}, searchText=${param.searchText})}"><</a>
            </li>
            <li class="page-item" th:classappend="${i == evaluationList.pageable.pageNumber + 1} ? 'disabled'" th:each="i : ${#numbers.sequence(startPage, endPage)}">
                <a class="page-link" th:href="@{/(page=${i - 1}, searchText=${param.searchText})}" th:text="${i}"></a>  <!-- index 넘기는 것에 주의 -->
            </li>
            <li class="page-item" th:classappend="${evaluationList.totalPages == evaluationList.pageable.pageNumber + 1} ? 'disabled'">
                <a class="page-link" th:href="@{/(page=${evaluationList.pageable.pageNumber + 1}, searchText=${param.searchText})}">></a>
            </li>
        </ul>
    </nav>
    <!-- 평가 수정 -->
    <div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fs-5" id="modal">강의평가 수정</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="id" class="form-control">
                    <div class="form-group">
                        <label>강의명</label>
                        <input type="text" name="lectureName" id="lectureName" class="form-control" maxlength="20" readonly>
                    </div>
                    <div class="form-group">
                        <label>강사명</label>
                        <input type="text" name="professorName" id="professorName" class="form-control" maxlength="20" readonly>
                    </div>
                    <div class="form-group">
                        <label>제목</label>
                        <input type="text" name="evaluationTitle" id="evaluationTitle" class="form-control" maxlength="30">
                    </div>
                    <div class="form-group mb-3">
                        <label>내용</label>
                        <textarea name="evaluationContent" id="evaluationContent" class="form-control" maxlength="2048" style="height: 180px;"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal" onclick="updateCheck()">수정하기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 신고하기 -->
    <div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="modal" aria-hiiden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fs-5" id="modal">신고하기</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/reportAction}" method="post">
                        <div class="form-group">
                            <label>신고 제목</label>
                            <input type="text" name="reportTitle" class="form-control" maxlength="30">
                        </div>
                        <div class="form-group mb-3">
                            <label>신고 내용</label>
                            <textarea name="reportContent" class="form-control" maxlength="2048" style="height: 180px;"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                            <button type="submit" class="btn btn-danger" data-bs-dismiss="modal">신고하기</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
<div th:replace="~{fragments/footer :: footerFragment}"></div>
</th:block>
<script th:src="@{js/common.js}"></script>
</body>
</html>